# Product Requirements Document (PRD): Project "Exit"
**Version:** 16.0 (The Final Master Blueprint - Production Ready)  
**Status:** Ready for Development  
**Date:** December 27, 2025  
**Owner:** Head of Product / Lead Architect  
**Target Market:** France (Launch), Global (Phase 2)  
**Core Philosophy:** "Maintenance, not Debt. Clearing the Static."

---

## EXECUTIVE SUMMARY

Exit is a premium iOS application that reframes digital wellbeing from moral failure to **neural hygiene**. Unlike competitors who position screen time as "debt" that creates shame, Exit positions it as **neural static**‚Äîcognitive entropy that naturally accumulates and must be cleared through positive offline actions.

**The Paradigm Shift:**

| Traditional Apps | Exit's Innovation |
|-----------------|-------------------|
| "You failed again" (Shame) | "Time to clean up" (Maintenance) |
| Binary: Good day vs. Bad day | Gradient: Clarity Level (0-100%) |
| Punishment-based friction | Reward-based restoration |
| Virtual rewards (trees) | Physical regulation (nervous system) |

**Strategic Positioning:**

| Competitor | Value Proposition | Exit's Advantage |
|------------|------------------|------------------|
| **Opal/Freedom** | Productivity (Work Focus) | **Clarity** (Neural Hygiene) |
| **One Sec** | Mindfulness (Waiting) | **Mobilization** (Active Cleaning) |
| **Forest** | Virtual Trees | **Real Nervous System Regulation** |

**The Opportunity:** Gen Z & Millennials experience "Functional Freeze"‚Äîknowing they should stop scrolling but physically unable due to dopamine/cortisol loops. Exit monetizes the transition from Freeze ‚Üí Mobilization through **physiological friction** (squats, breathing) and positions itself as a **high-status lifestyle upgrade** rather than a "digital detox."

---

## SECTION 1: THE NEURAL LEDGER MECHANIC

### **1.1 The Core Metaphor**

**The Problem:**  
Every minute spent scrolling social media adds **neural static**‚Äîcognitive noise that makes it harder to think clearly, make decisions, or feel present.

**The Solution:**  
Exit visualizes this static in real-time and provides **cleaning tools** (physical actions) to restore clarity.

**The Metaphor:**
```
Scrolling = Getting your glasses dirty
Physical Actions = Wiping them clean
```

You don't wipe your glasses because you're "in debt" to dirt. You wipe them to **maintain visibility**.

---

### **1.2 The Noise Accumulation Formula**

#### **Algorithm: How Noise is Calculated**

```typescript
// The Neural Static Formula
const calculateNoise = (screenTimeMinutes: number, cleanedMinutes: number): number => {
  // Base noise from scrolling
  const scrollingNoise = screenTimeMinutes * 0.5;
  
  // Noise reduction from actions
  const cleaningReduction = cleanedMinutes * 2;
  
  // Final noise level (capped at 0-100)
  const noise = Math.max(0, Math.min(100, scrollingNoise - cleaningReduction));
  
  return noise;
}

// Example Scenarios:
// 1. User scrolls for 60 mins, no actions
//    Noise = 60 * 0.5 = 30%
//
// 2. User scrolls for 120 mins (2 hours), no actions
//    Noise = 120 * 0.5 = 60%
//
// 3. User scrolls for 120 mins, then does 10 squats (2 mins)
//    Noise = (120 * 0.5) - (2 * 2) = 60 - 4 = 56%
//
// 4. User scrolls for 120 mins, then does 20 squats (4 mins) + breathing (1 min)
//    Noise = (120 * 0.5) - (5 * 2) = 60 - 10 = 50%
```

#### **App-Specific Noise Rates**

Different apps have different "dopamine variance" and thus accumulate noise at different rates:

```typescript
const NOISE_RATES: Record<string, number> = {
  // High dopamine variance (unpredictable reward)
  'com.zhiliaoapp.musically': 1.5,        // TikTok
  'com.instagram.instagram': 1.0,         // Instagram
  'com.facebook.Facebook': 1.0,           // Facebook
  
  // Medium dopamine variance
  'com.twitter.twitter': 0.8,             // Twitter/X
  'com.reddit.Reddit': 0.8,               // Reddit
  
  // Low dopamine variance (passive consumption)
  'com.google.ios.youtube': 0.5,          // YouTube
  'com.netflix.Netflix': 0.3,             // Netflix
  
  // Default for unknown apps
  'default': 0.5,
};

// Calculate noise per app
const getNoiseRateForApp = (bundleId: string): number => {
  return NOISE_RATES[bundleId] || NOISE_RATES['default'];
};
```

---

### **1.3 Visual Consequences: The Skia Shader System**

#### **Implementation: React Native Skia FractalNoise**

React Native Skia provides built-in FractalNoise shaders optimized for 60 FPS performance with GPU hardware acceleration.

```typescript
// components/NoiseOverlay.tsx
import React, { useMemo } from 'react';
import {
  Canvas,
  Fill,
  Shader,
  Skia,
  vec,
  FractalNoise,
} from '@shopify/react-native-skia';
import { useSharedValue, useFrameCallback } from 'react-native-reanimated';
import { Dimensions } from 'react-native';

interface NoiseOverlayProps {
  noiseLevel: number; // 0-100
}

export const NoiseOverlay: React.FC<NoiseOverlayProps> = ({ noiseLevel }) => {
  const { width, height } = Dimensions.get('window');
  const time = useSharedValue(0);
  
  // Animate time for dynamic noise
  useFrameCallback((frameInfo) => {
    time.value += frameInfo.timeSincePreviousFrame ? frameInfo.timeSincePreviousFrame * 0.001 : 0;
  });
  
  // Create custom shader for grain + chromatic aberration
  const noiseShader = useMemo(() => {
    const source = Skia.RuntimeEffect.Make(`
      uniform float2 resolution;
      uniform float time;
      uniform float noiseIntensity; // 0.0 - 1.0
      uniform shader noise;
      
      // Simple random function for grain
      float random(vec2 st) {
        return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);
      }
      
      // Perlin noise function
      float noise2D(vec2 st) {
        vec2 i = floor(st);
        vec2 f = fract(st);
        
        float a = random(i);
        float b = random(i + vec2(1.0, 0.0));
        float c = random(i + vec2(0.0, 1.0));
        float d = random(i + vec2(1.0, 1.0));
        
        vec2 u = f * f * (3.0 - 2.0 * f);
        return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.x * u.y;
      }
      
      vec4 main(vec2 fragCoord) {
        vec2 st = fragCoord / resolution;
        
        // Dynamic grain that changes over time
        float grain = noise2D(st * 20.0 + time * 0.5);
        
        // Chromatic aberration at high noise levels
        float aberration = noiseIntensity * 0.005;
        vec2 rOffset = vec2(aberration, 0.0);
        vec2 bOffset = vec2(-aberration, 0.0);
        
        // Combine grain with chromatic shift
        float finalGrain = grain * noiseIntensity * 0.6;
        
        // Add subtle color shift for high noise
        vec3 color = vec3(
          finalGrain + (noiseIntensity > 0.8 ? 0.1 : 0.0), // Red tint at high noise
          finalGrain,
          finalGrain - (noiseIntensity > 0.8 ? 0.05 : 0.0)  // Blue reduction at high noise
        );
        
        // Alpha increases with noise intensity
        float alpha = noiseIntensity * 0.85;
        
        return vec4(color, alpha);
      }
    `);
    
    if (!source) {
      console.error('Failed to compile noise shader');
      return null;
    }
    
    return source;
  }, []);
  
  if (!noiseShader) {
    return null;
  }
  
  // Map noiseLevel (0-100) to shader intensity (0.0-1.0)
  const intensity = Math.min(noiseLevel / 100, 1.0);
  
  return (
    <Canvas
      style={{
        position: 'absolute',
        width,
        height,
        zIndex: 10,
        pointerEvents: 'none', // Don't block touch events
      }}
    >
      <Fill>
        <Shader source={noiseShader}>
          <FractalNoise
            freqX={0.05}
            freqY={0.05}
            octaves={4}
            seed={time.value}
          />
          <uniforms>
            <uniform name="resolution">{vec(width, height)}</uniform>
            <uniform name="time">{time.value}</uniform>
            <uniform name="noiseIntensity">{intensity}</uniform>
          </uniforms>
        </Shader>
      </Fill>
    </Canvas>
  );
};
```

#### **Visual State Progression**

| Noise Level | Visual State | Avatar State | UI Readability | User Experience |
|-------------|-------------|--------------|----------------|-----------------|
| **0-20%** | Crystal Clear | Vitality (Orange glow) | Perfect | Clean, crisp interface |
| **21-50%** | Light Grain | Rot begins (Green tint) | Good | Subtle texture, still readable |
| **51-80%** | Heavy Static | Deep Rot (Slouched) | Degraded | Noticeable interference, harder to read |
| **81-100%** | Fog Mode | Zombie (Glitched) | Barely readable | Chromatic aberration, stats nearly hidden |

**Critical UX Principle:** The user **literally cannot see their stats clearly** until they clean the static. This creates **functional friction**, not just psychological pressure. The motivation is **intrinsic** (I want to see my data) not **extrinsic** (I should stop scrolling).

---

### **1.4 The "Wiper" Animation: Clearing Static**

When a user completes an action from the Dopamine Menu, a **liquid wipe animation** sweeps across the screen, clearing a patch of static.

#### **Implementation**

```typescript
// components/WiperAnimation.tsx
import React, { useEffect } from 'react';
import { MotiView } from 'moti';
import { Dimensions, StyleSheet } from 'react-native';
import * as Haptics from 'expo-haptics';
import { SoundManager } from '../utils/SoundManager';
import { LinearGradient } from 'expo-linear-gradient';

interface WiperAnimationProps {
  visible: boolean;
  noiseClearedPercent: number; // How much noise was cleared (e.g., 10%)
  onComplete: () => void;
}

export const WiperAnimation: React.FC<WiperAnimationProps> = ({
  visible,
  noiseClearedPercent,
  onComplete,
}) => {
  const { width, height } = Dimensions.get('window');
  
  useEffect(() => {
    if (visible) {
      // Play satisfying "liquid swipe" sound
      SoundManager.playWipeSound();
      
      // Crisp haptic feedback (clarity restored)
      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Heavy);
      
      // Follow-up gentle haptic (completeness)
      setTimeout(() => {
        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
      }, 150);
      
      // Auto-complete after animation
      setTimeout(onComplete, 1000);
    }
  }, [visible]);
  
  if (!visible) return null;
  
  // Wiper blade width scales with noise cleared
  // 10% cleared = 20% of screen width
  // 30% cleared = 60% of screen width
  const bladeWidth = width * (noiseClearedPercent / 100) * 2;
  
  return (
    <MotiView
      from={{
        translateX: -bladeWidth,
        opacity: 0.95,
      }}
      animate={{
        translateX: width + bladeWidth,
        opacity: 0,
      }}
      transition={{
        type: 'timing',
        duration: 1000,
        easing: 'ease-out',
      }}
      style={{
        position: 'absolute',
        top: 0,
        left: -bladeWidth,
        width: bladeWidth,
        height: height,
        zIndex: 999,
      }}
    >
      <LinearGradient
        colors={['rgba(6, 255, 165, 0)', 'rgba(6, 255, 165, 0.95)', 'rgba(6, 255, 165, 0)']}
        start={{ x: 0, y: 0.5 }}
        end={{ x: 1, y: 0.5 }}
        style={StyleSheet.absoluteFill}
      />
    </MotiView>
  );
};
```

**Usage Example:**

```typescript
// screens/ChallengeScreen.tsx
const [showWiper, setShowWiper] = useState(false);

const handleChallengeComplete = async (action: MicroAction) => {
  // Clear noise
  await clearNoise(action.noiseClearedPercent);
  
  // Trigger wiper animation
  setShowWiper(true);
};

return (
  <>
    <SquatCounter />
    <WiperAnimation
      visible={showWiper}
      noiseClearedPercent={20} // Squats clear 20%
      onComplete={() => {
        setShowWiper(false);
        router.back();
      }}
    />
  </>
);
```

---

## SECTION 2: THE "QUIET LUXURY" UI SYSTEM

### **2.1 Design Philosophy: Ethereal Minimalism**

Exit's visual identity is inspired by **Quiet Luxury**‚Äîunderstated elegance that signals sophistication without screaming for attention. Think: minimalist watch faces, premium banking apps, high-end product photography.

**Key Principles:**
- **Void as Canvas:** Pure black (#050505) creates infinite depth
- **Ethereal White:** Off-white (#F5F5F0) feels organic, not digital
- **Vitality Accent:** Soft glowing orange (#FF6B35) represents life force, not neon urgency
- **Liquid Glass:** All surfaces use blur + refraction for depth

---

### **2.2 Color Palette (Production-Ready)**

```typescript
// tamagui.config.ts
import { createTamagui, createTokens } from 'tamagui';

const exitTokens = createTokens({
  color: {
    // Core Identity
    void_black: '#050505',          // OLED-optimized near-black
    ethereal_white: '#F5F5F0',      // Warm off-white
    
    // Vitality Accent (Updated)
    vitality_orange: '#FF6B35',     // Soft glowing orange (current)
    // Alternative option for consideration:
    vitality_amber: '#FFA94D',      // Warmer, more life-affirming amber
    // Recommendation: Use #FF6B35 for its "nervous system activation" energy
    
    // Clarity States
    clarity_crystal: '#E8F4F8',     // Pristine clarity (0-20% noise)
    clarity_blue: '#00D9FF',        // High clarity accent
    fog_gray: '#7F8C8D',            // Medium clarity (21-50% noise)
    static_red: '#E63946',          // Low clarity warning (51-100% noise)
    
    // Actions
    clean_green: '#06FFA5',         // Cleaning action completed (success glow)
    neural_blue: '#4ECDC4',         // Focus/regulation state
    
    // UI Surfaces
    shield_bg: '#0A0A0A',           // Shield overlay background
    glass_surface: '#1A1A1A',       // Card/container background
    glass_border: 'rgba(245, 245, 240, 0.1)', // Subtle borders
  },
  
  space: {
    breath: 24,   // Breathing exercise spacing
    toll: 16,     // Friction payment spacing
    zen: 32,      // Large meditative spacing
    micro: 8,     // Micro-interactions
  },
  
  size: {
    avatar: 120,
    shieldButton: 240,
    glass_card: 340,
  },
  
  radius: {
    shield: 20,
    glass: 16,
    pill: 999,
  },
});

// Typography: Space Mono for Technical Aesthetic
const exitFonts = {
  heading: {
    family: 'SpaceMono',
    size: {
      1: 48,  // Hero text
      2: 32,  // Section headers
      3: 24,  // Subsections
      4: 18,  // Body large
    },
    weight: {
      bold: '700',
      normal: '400',
    },
    letterSpacing: {
      tight: -1,
      normal: 0,
      wide: 2,
    },
  },
  body: {
    family: 'Inter',
    size: {
      1: 16,
      2: 14,
      3: 12,
    },
  },
};

const exitConfig = createTamagui({
  tokens: exitTokens,
  themes: {
    dark: {
      background: exitTokens.color.void_black,
      backgroundHover: exitTokens.color.glass_surface,
      color: exitTokens.color.ethereal_white,
      colorHover: exitTokens.color.clarity_blue,
      
      primary: exitTokens.color.vitality_orange,
      secondary: exitTokens.color.neural_blue,
      success: exitTokens.color.clean_green,
      danger: exitTokens.color.static_red,
    },
  },
  fonts: exitFonts,
});

export default exitConfig;
```

---

### **2.3 Liquid Glass Components**

```typescript
// components/GlassCard.tsx
import React from 'react';
import { Stack, styled } from 'tamagui';
import { BlurView } from 'expo-blur';

export const GlassCard = styled(Stack, {
  name: 'GlassCard',
  backgroundColor: '$glass_surface',
  borderRadius: '$glass',
  padding: '$toll',
  borderWidth: 1,
  borderColor: '$glass_border',
  
  // Shadow for depth
  shadowColor: '$void_black',
  shadowOffset: { width: 0, height: 4 },
  shadowOpacity: 0.3,
  shadowRadius: 12,
  elevation: 8,
  
  variants: {
    frosted: {
      true: {
        // Use BlurView for glassmorphism
        overflow: 'hidden',
      },
    },
    glow: {
      true: {
        borderColor: '$vitality_orange',
        shadowColor: '$vitality_orange',
        shadowOpacity: 0.4,
      },
    },
  },
});

// Usage with blur
export const FrostedGlassCard: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  return (
    <GlassCard frosted>
      <BlurView intensity={80} tint="dark" style={{ borderRadius: 16, overflow: 'hidden' }}>
        <Stack padding="$toll">
          {children}
        </Stack>
      </BlurView>
    </GlassCard>
  );
};
```

---

## SECTION 3: THE DOPAMINE MENU (POSITIVE ACCOUNTABILITY)

### **3.1 Philosophical Reframe**

**Traditional Framing:**
- "You must pay back screen time debt"
- "Complete this punishment to unlock"
- Focus: What you did wrong

**Exit's Framing:**
- "Here are tools to restore your clarity"
- "Choose an action that feels right now"
- Focus: What feels good to do

The Dopamine Menu is a **reward**, not a punishment. Users don't feel coerced; they feel empowered.

---

### **3.2 Micro-Actions Database (Expanded)**

```json
// data/microActions.json
[
  {
    "id": "ma_001",
    "category": "breathing",
    "energy": "low",
    "duration": 1,
    "noiseClearedPercent": 5,
    "title_fr": "Respiration Carr√©e",
    "description_fr": "60 secondes de respiration 4-4-4-4",
    "instruction_fr": "Inspire 4s, retiens 4s, expire 4s, retiens 4s",
    "icon": "ü´Å",
    "proOnly": false,
    "hapticPattern": "heartbeat"
  },
  {
    "id": "ma_002",
    "category": "movement",
    "energy": "medium",
    "duration": 2,
    "noiseClearedPercent": 10,
    "title_fr": "10 Squats",
    "description_fr": "Activation rapide des jambes",
    "instruction_fr": "Descends lentement, remonte fort",
    "icon": "üèãÔ∏è",
    "proOnly": true,
    "hapticPattern": "toll"
  },
  {
    "id": "ma_003",
    "category": "movement",
    "energy": "high",
    "duration": 3,
    "noiseClearedPercent": 15,
    "title_fr": "20 Pompes",
    "description_fr": "R√©initialisation du haut du corps",
    "instruction_fr": "Garde le corps droit, descends jusqu'au sol",
    "icon": "üí™",
    "proOnly": true,
    "hapticPattern": "toll"
  },
  {
    "id": "ma_004",
    "category": "movement",
    "energy": "high",
    "duration": 10,
    "noiseClearedPercent": 20,
    "title_fr": "Marcher 500 Pas",
    "description_fr": "Sortir et bouger",
    "instruction_fr": "Sors de chez toi, respire l'air frais",
    "icon": "üö∂",
    "proOnly": true,
    "hapticPattern": "toll"
  },
  {
    "id": "ma_005",
    "category": "hydration",
    "energy": "low",
    "duration": 0.5,
    "noiseClearedPercent": 3,
    "title_fr": "Boire de l'Eau",
    "description_fr": "Un verre d'eau (250ml)",
    "instruction_fr": "Bois lentement, ressens l'eau descendre",
    "icon": "üíß",
    "proOnly": false,
    "hapticPattern": "gentle"
  },
  {
    "id": "ma_006",
    "category": "sensory",
    "energy": "medium",
    "duration": 5,
    "noiseClearedPercent": 30,
    "title_fr": "Douche Froide 5 Min",
    "description_fr": "R√©initialisation compl√®te du syst√®me nerveux",
    "instruction_fr": "Commence ti√®de, termine √† froid",
    "icon": "üöø",
    "proOnly": true,
    "hapticPattern": "shock"
  },
  {
    "id": "ma_007",
    "category": "sensory",
    "energy": "low",
    "duration": 10,
    "noiseClearedPercent": 8,
    "title_fr": "Bruit Brun 10 Min",
    "description_fr": "Audio basse fr√©quence apaisante",
    "instruction_fr": "Allonge-toi, ferme les yeux, √©coute",
    "icon": "üéµ",
    "proOnly": false,
    "hapticPattern": "heartbeat"
  },
  {
    "id": "ma_008",
    "category": "social",
    "energy": "medium",
    "duration": 5,
    "noiseClearedPercent": 12,
    "title_fr": "Appeler un Ami",
    "description_fr": "Connexion r√©elle, pas digitale",
    "instruction_fr": "Appel vocal de 5 minutes minimum",
    "icon": "üìû",
    "proOnly": true,
    "hapticPattern": "gentle"
  }
]
```

---

### **3.3 The "Spin the Wheel" Interaction**

The Dopamine Menu is presented as a **physical wheel** that users spin to select an action. This creates:
- **Agency:** User chooses their path to clarity
- **Delight:** Spinning feels like a premium slot machine (without gambling)
- **Discovery:** Users encounter new actions organically

#### **Implementation**

```typescript
// components/DopamineWheel.tsx
import React, { useState } from 'react';
import { MotiView, useDynamicAnimation } from 'moti';
import { Stack, Text } from 'tamagui';
import { HapticMap } from '../utils/HapticMap';
import { SoundManager } from '../utils/SoundManager';
import { MicroAction } from '../types';

interface DopamineWheelProps {
  actions: MicroAction[];
  onSelect: (action: MicroAction) => void;
}

export const DopamineWheel: React.FC<DopamineWheelProps> = ({
  actions,
  onSelect,
}) => {
  const [selectedIndex, setSelectedIndex] = useState<number | null>(null);
  const [isSpinning, setIsSpinning] = useState(false);
  const spinAnimation = useDynamicAnimation(() => ({ rotate: '0deg' }));
  
  const spinWheel = () => {
    if (isSpinning) return;
    
    setIsSpinning(true);
    setSelectedIndex(null);
    
    // Random spin between 1080¬∞ and 1440¬∞ (3-4 full rotations)
    const spins = Math.floor(Math.random() * 360) + 1080;
    const finalIndex = Math.floor((spins % 360) / (360 / actions.length));
    
    // Haptic ticks during spin (simulating mechanical ratchet)
    const tickInterval = setInterval(() => {
      HapticMap.selection();
    }, 100);
    
    // Play spinning sound
    SoundManager.playSpinSound();
    
    // Animate rotation
    spinAnimation.animateTo(
      { rotate: `${spins}deg` },
      {
        type: 'timing',
        duration: 2500,
        easing: 'ease-out', // Natural deceleration
      }
    );
    
    // Complete after animation
    setTimeout(() => {
      clearInterval(tickInterval);
      setSelectedIndex(finalIndex);
      setIsSpinning(false);
      
      // Achievement haptic
      HapticMap.achievement();
      
      // Call selection
      onSelect(actions[finalIndex]);
    }, 2500);
  };
  
  return (
    <Stack alignItems="center" space="$toll">
      {/* Wheel Visual */}
      <MotiView
        state={spinAnimation}
        style={{
          width: 300,
          height: 300,
          justifyContent: 'center',
          alignItems: 'center',
        }}
      >
        <WheelSegments actions={actions} />
      </MotiView>
      
      {/* Spin Button */}
      <Button
        backgroundColor="$vitality_orange"
        onPress={spinWheel}
        disabled={isSpinning}
        fontSize="$2"
        fontFamily="$heading"
        paddingHorizontal="$zen"
        paddingVertical="$toll"
        pressStyle={{
          scale: 0.95,
          backgroundColor: '$vitality_amber',
        }}
      >
        {isSpinning ? 'Rotation...' : 'Tourner la Roue'}
      </Button>
      
      {/* Selected Action Display */}
      {selectedIndex !== null && (
        <MotiView
          from={{ opacity: 0, scale: 0.8, translateY: 20 }}
          animate={{ opacity: 1, scale: 1, translateY: 0 }}
          transition={{ type: 'spring', damping: 15 }}
        >
          <FrostedGlassCard>
            <Stack alignItems="center" space="$micro">
              <Text fontSize={48}>{actions[selectedIndex].icon}</Text>
              <Text fontSize="$2" color="$vitality_orange" fontFamily="$heading">
                {actions[selectedIndex].title_fr}
              </Text>
              <Text fontSize="$3" color="$color" opacity={0.8} textAlign="center">
                {actions[selectedIndex].description_fr}
              </Text>
              <Text fontSize="$4" color="$clean_green" fontFamily="$heading">
                Efface {actions[selectedIndex].noiseClearedPercent}% de static
              </Text>
            </Stack>
          </FrostedGlassCard>
        </MotiView>
      )}
    </Stack>
  );
};
```

---

### **3.4 Context-Aware Recommendations**

The app suggests actions based on:
- **Time of day** (morning = high energy, night = low energy)
- **Current noise level** (high noise = high-impact actions)
- **Recent actions** (diversity to prevent boredom)
- **Pro status** (free users see limited options)

```typescript
// utils/MicroActionRecommender.ts
interface RecommendationContext {
  timeOfDay: 'morning' | 'afternoon' | 'evening' | 'night';
  noiseLevel: number;
  userEnergy: 'low' | 'medium' | 'high';
  recentCategories: string[];
  isPro: boolean;
}

export class MicroActionRecommender {
  static getRecommendations(
    context: RecommendationContext,
    count: number = 5
  ): MicroAction[] {
    // Filter by Pro status
    let candidates = microActions.filter(
      (action) => !action.proOnly || context.isPro
    );
    
    // Filter by energy level
    candidates = candidates.filter(
      (action) => action.energy === context.userEnergy
    );
    
    // CRITICAL: If noise is high, prioritize high-impact actions
    if (context.noiseLevel >= 70) {
      candidates = candidates.filter(
        (action) => action.noiseClearedPercent >= 15
      );
    }
    
    // Diversity: Deprioritize recently used categories
    candidates.sort((a, b) => {
      const aRecent = context.recentCategories.includes(a.category) ? 1 : 0;
      const bRecent = context.recentCategories.includes(b.category) ? 1 : 0;
      return aRecent - bRecent;
    });
    
    // Time-based filtering
    const timeWeights: Record<string, string[]> = {
      morning: ['movement', 'hydration'],
      afternoon: ['movement', 'social'],
      evening: ['breathing', 'sensory'],
      night: ['breathing', 'sensory'],
    };
    
    // Boost actions that match time of day
    candidates.sort((a, b) => {
      const aMatch = timeWeights[context.timeOfDay].includes(a.category) ? -1 : 0;
      const bMatch = timeWeights[context.timeOfDay].includes(b.category) ? -1 : 0;
      return aMatch - bMatch;
    });
    
    return candidates.slice(0, count);
  }
}
```

---

## SECTION 4: THE 3-PHASE ROLLOUT STRATEGY

### **Phase 1: Alpha (Internal Testing - Weeks 1-4)**

**Goal:** Validate core mechanics with internal team (10-20 people).

**Features:**
- ‚úÖ Somatic Shield (Breathing only)
- ‚úÖ Basic Noise visualization (Skia shader)
- ‚úÖ Rot Avatar (2 states: Vitality, Rot)
- ‚úÖ Onboarding flow ("Silence the Noise")
- ‚úÖ Manual action logging (no sensor detection yet)

**Success Criteria:**
- Shield appears < 200ms after opening blocked app
- Noise formula feels intuitive (30 mins = 15% noise)
- Avatar transitions smoothly (no janky animations)
- Zero crashes in 7-day usage

**Deliverables:**
- Internal TestFlight build
- Feedback form (Google Forms)
- Video walkthrough for team

---

### **Phase 2: Beta (TestFlight - Weeks 5-10)**

**Goal:** Test with real users in France (1,000 users).

**Features:**
- ‚úÖ All Phase 1 features
- ‚úÖ Squat Detection (Accelerometer + Deep Link Hack)
- ‚úÖ Dopamine Menu (5 actions minimum)
- ‚úÖ "Spin the Wheel" UI
- ‚úÖ Push Notifications:
  - "Morning Pledge" (9 AM): "Quelle est ta clart√© aujourd'hui?"
  - "Doom Loop Alert" (real-time): "3 app switches d√©tect√©s. Respire."
- ‚úÖ In-App Support (Intercom or Crisp chat)
- ‚úÖ Basic analytics (Firebase)

**Success Criteria:**
- Day-7 retention > 50%
- Average 3 cleanings per day per active user
- < 5% uninstall rate
- NPS > 40

**User Acquisition:**
- ProductHunt launch (France-specific)
- Reddit r/nosurf community
- Instagram ads targeting France (Gen Z)

**Deliverables:**
- Public TestFlight link
- Feedback loop (in-app + email)
- Weekly metrics dashboard

---

### **Phase 3: Launch (App Store - Weeks 11-16)**

**Goal:** Full public launch in France with monetization.

**Features:**
- ‚úÖ All Phase 2 features
- ‚úÖ **"Mode Repas"** (France-specific):
  - One-tap 1-hour block during lunch (12-2 PM)
  - Whitelist: Phone, SMS only
  - Cultural messaging: "Profite de ton d√©jeuner"
- ‚úÖ **Founding Member Paywall** (RevenueCat):
  - Free: Breathing + Water (clears 5-8% noise)
  - Pro: All actions (clears up to 30% noise)
  - Pricing: ‚Ç¨9.99/month, ‚Ç¨59.99/year (save 50%)
- ‚úÖ **Clarity Circle Leaderboards**:
  - Invite friends
  - See group average clarity
  - Supportive rankings (not competitive)
- ‚úÖ **Smart Ratings Prompt**:
  - Trigger after 3 successful cleanings
  - "Tu restaures ta clart√©. Aide d'autres √† d√©couvrir Exit."

**Success Criteria:**
- 10,000 downloads in first month
- 5% conversion to Pro (500 paid users)
- Day-30 retention > 40%
- NPS > 50

**Marketing:**
- PR: TechCrunch, The Verge coverage
- Influencers: French wellness/productivity creators
- Content: "How I quit TikTok" testimonials

**Deliverables:**
- App Store submission with Family Controls justification
- Localized App Store screenshots + video
- Press kit + media outreach

---

## SECTION 5: TECHNICAL SPECIFICATIONS (iOS FIRST)

### **5.1 iOS Extensions (FamilyControls)**

Exit requires **three native iOS app extensions**:

1. **DeviceActivityMonitor** - Tracks usage thresholds
2. **ShieldConfiguration** - Custom shield UI
3. **ShieldAction** - Handle shield button taps

#### **DeviceActivityMonitor Extension**

```swift
// DeviceActivityMonitorExtension/ExitMonitor.swift
import DeviceActivity
import Foundation

class ExitDeviceActivityMonitor: DeviceActivityMonitor {
    let appGroup = "group.com.exit.app"
    
    // Called when threshold is reached (e.g., 30 mins of TikTok)
    override func eventDidReachThreshold(
        _ event: DeviceActivityEvent.Name,
        activity: DeviceActivityName
    ) {
        super.eventDidReachThreshold(event, activity: activity)
        
        // Write event to App Group for main app
        let defaults = UserDefaults(suiteName: appGroup)
        defaults?.set(Date().timeIntervalSince1970, forKey: "last_threshold_event")
        defaults?.set(event.rawValue, forKey: "triggered_event")
        defaults?.synchronize()
        
        // Increment noise level based on app usage
        let currentNoise = defaults?.integer(forKey: "noise_level") ?? 0
        let noiseToAdd = 15 // 30 mins * 0.5 noise rate
        let newNoise = min(currentNoise + noiseToAdd, 100)
        defaults?.set(newNoise, forKey: "noise_level")
        defaults?.synchronize()
    }
}
```

#### **ShieldConfiguration Extension (Updated with Noise Display)**

```swift
// ShieldConfigurationExtension/ExitShieldConfig.swift
import ManagedSettings
import ManagedSettingsUI
import DeviceActivity

class ExitShieldConfigurationDataSource: ShieldConfigurationDataSource {
    let appGroup = "group.com.exit.app"
    
    override func configuration(
        shielding application: Application
    ) -> ShieldConfiguration {
        let defaults = UserDefaults(suiteName: appGroup)
        let noiseLevel = defaults?.integer(forKey: "noise_level") ?? 0
        let completedAt = defaults?.double(forKey: "last_challenge_completed") ?? 0
        let now = Date().timeIntervalSince1970
        
        // If challenge completed within 60 seconds, allow access
        if now - completedAt < 60 {
            return ShieldConfiguration(
                backgroundBlurStyle: .light,
                backgroundColor: UIColor(hex: "#06FFA5"),
                title: ShieldConfiguration.Label(
                    text: "Clart√© Restaur√©e! ‚úÖ",
                    color: .white
                ),
                subtitle: ShieldConfiguration.Label(
                    text: "Tu as 60 secondes",
                    color: .white
                )
            )
        }
        
        // Show challenge prompt with current noise level
        return ShieldConfiguration(
            backgroundBlurStyle: .dark,
            backgroundColor: UIColor(hex: "#0A0A0A"),
            title: ShieldConfiguration.Label(
                text: "Static D√©tect√©: \(noiseLevel)%",
                color: UIColor(hex: "#E63946")
            ),
            subtitle: ShieldConfiguration.Label(
                text: "Nettoie ton syst√®me nerveux",
                color: .white
            ),
            primaryButtonLabel: ShieldConfiguration.Label(
                text: "Commencer le Nettoyage",
                color: .white
            ),
            primaryButtonBackgroundColor: UIColor(hex: "#FF6B35")
        )
    }
}
```

---

### **5.2 The "Sensor Hack" Architecture**

**Problem:** iOS shield extensions are sandboxed and cannot access CoreMotion (accelerometer) or microphone.

**Solution:** Deep Link Loop

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      SENSOR HACK FLOW                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ  1. User opens blocked app (e.g., Instagram)               ‚îÇ
‚îÇ     ‚Üì                                                       ‚îÇ
‚îÇ  2. ShieldConfiguration displays custom UI                 ‚îÇ
‚îÇ     ‚Üì                                                       ‚îÇ
‚îÇ  3. User taps "Commencer le Nettoyage"                     ‚îÇ
‚îÇ     ‚Üì                                                       ‚îÇ
‚îÇ  4. ShieldAction extension sets flag in App Group:         ‚îÇ
‚îÇ     - challenge_requested = true                           ‚îÇ
‚îÇ     - blocked_app = "instagram"                            ‚îÇ
‚îÇ     ‚Üì                                                       ‚îÇ
‚îÇ  5. Main app polls App Group every 1 second                ‚îÇ
‚îÇ     ‚Üì                                                       ‚îÇ
‚îÇ  6. Main app detects flag, opens Challenge screen          ‚îÇ
‚îÇ     ‚Üí NOW HAS FULL SENSOR ACCESS                           ‚îÇ
‚îÇ     ‚Üì                                                       ‚îÇ
‚îÇ  7. User completes squats (CoreMotion detects)             ‚îÇ
‚îÇ     ‚Üì                                                       ‚îÇ
‚îÇ  8. Completion timestamp written to App Group              ‚îÇ
‚îÇ     - last_challenge_completed = Date.now()                ‚îÇ
‚îÇ     ‚Üì                                                       ‚îÇ
‚îÇ  9. Shield reads timestamp, allows 60s access              ‚îÇ
‚îÇ                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### **Implementation: Deep Link Handler**

```typescript
// app/_layout.tsx
import { useEffect } from 'react';
import { useRouter } from 'expo-router';
import { SharedStorage } from '../utils/SharedStorage';

export default function RootLayout() {
  const router = useRouter();
  
  useEffect(() => {
    // Poll for challenge requests from shield extension
    const pollInterval = setInterval(async () => {
      const requested = await SharedStorage.get<boolean>('challenge_requested');
      
      if (requested) {
        const blockedApp = await SharedStorage.get<string>('blocked_app');
        
        // Clear flag
        await SharedStorage.set('challenge_requested', false);
        
        // Navigate to challenge
        router.push(`/challenge?app=${blockedApp || 'unknown'}`);
      }
    }, 1000); // Poll every second
    
    return () => clearInterval(pollInterval);
  }, []);
  
  return <Slot />;
}
```

---

### **5.3 Privacy: Local-First Architecture**

**Principle:** User privacy is paramount. Raw screen time data NEVER leaves the device.

#### **What Gets Stored Locally (On-Device)**

```typescript
interface LocalState {
  // SENSITIVE - NEVER SYNCED
  appUsageLog: AppUsageRecord[];        // Package names + timestamps
  doomLoopEvents: DoomLoopEvent[];       // Detected patterns
  interventionHistory: Intervention[];   // When shields were triggered
  
  // SANITIZED - SYNCED TO FIREBASE
  dailyStreak: number;
  currentLevel: string; // "Bronze", "Silver", "Gold"
  clarityScore: number; // 0-100
  totalMinutesSaved: number;
  lastSyncTimestamp: number;
}
```

#### **What Gets Synced to Firebase**

```typescript
// Firestore: users/{uid}/stats/{date}
interface UserStats {
  date: string;              // YYYY-MM-DD
  streak: number;
  clarityScore: number;      // Average clarity for the day
  minutesSaved: number;
  interventionsTriggered: number; // Count only, no details
  
  // Metadata
  lastUpdated: FirebaseFirestore.Timestamp;
  appVersion: string;
}
```

**Zero PII Transmission:** Firebase never sees which apps the user opened or when. Only aggregate statistics.

---

## SECTION 6: MONETIZATION (REVENUECAT IMPLEMENTATION)

### **6.1 Free vs Pro: Clarity Tools**

| Feature | Free Tier | Pro Tier (‚Ç¨9.99/mo) |
|---------|-----------|---------------------|
| **Breathing** | ‚úÖ Clears 5% noise | ‚úÖ Clears 5% noise |
| **Drink Water** | ‚úÖ Clears 3% noise | ‚úÖ Clears 3% noise |
| **Brown Noise** | ‚úÖ Clears 8% noise | ‚úÖ Clears 8% noise |
| **10 Squats** | ‚ùå Locked | ‚úÖ Clears 10% noise |
| **20 Pushups** | ‚ùå Locked | ‚úÖ Clears 15% noise |
| **Walk 500 Steps** | ‚ùå Locked | ‚úÖ Clears 20% noise |
| **Cold Shower** | ‚ùå Locked | ‚úÖ Clears 30% noise |
| **Noise Visualization** | Up to 50% | Up to 100% |
| **Avatar States** | Vitality, Rot | Vitality, Rot, Zombie |
| **Clarity Circle** | ‚ùå | ‚úÖ Leaderboards |
| **Mode Repas** | ‚ùå | ‚úÖ France-specific |

---

### **6.2 RevenueCat Implementation**

RevenueCat provides native Paywall UI for React Native that supports localization, intro offers, and A/B testing out of the box.

#### **Setup**

```bash
npm install react-native-purchases react-native-purchases-ui
cd ios && pod install && cd ..
```

#### **Configuration**

```typescript
// utils/RevenueCatConfig.ts
import Purchases from 'react-native-purchases';
import { Platform } from 'react-native';

export const initializeRevenueCat = async () => {
  Purchases.configure({
    apiKey: Platform.OS === 'ios'
      ? process.env.REVENUECAT_IOS_API_KEY!
      : process.env.REVENUECAT_ANDROID_API_KEY!,
  });
  
  // Enable debug logging in development
  if (__DEV__) {
    Purchases.setLogLevel(Purchases.LOG_LEVEL.DEBUG);
  }
};
```

#### **Paywall Presentation**

```typescript
// screens/PaywallScreen.tsx
import RevenueCatUI, { PAYWALL_RESULT } from 'react-native-purchases-ui';
import { useRouter } from 'expo-router';

export default function PaywallScreen() {
  const router = useRouter();
  
  const handlePresentPaywall = async () => {
    const result = await RevenueCatUI.presentPaywall({
      // Can specify a specific offering or use default
    });
    
    switch (result) {
      case PAYWALL_RESULT.PURCHASED:
      case PAYWALL_RESULT.RESTORED:
        // User is now Pro
        router.replace('/dashboard');
        break;
        
      case PAYWALL_RESULT.CANCELLED:
        // User dismissed paywall
        break;
        
      case PAYWALL_RESULT.ERROR:
      case PAYWALL_RESULT.NOT_PRESENTED:
        console.error('Paywall error');
        break;
    }
  };
  
  // Trigger paywall on mount or via button
  useEffect(() => {
    handlePresentPaywall();
  }, []);
  
  return null; // RevenueCat displays its own UI
}
```

#### **Checking Pro Status**

```typescript
// hooks/useProStatus.ts
import { useState, useEffect } from 'react';
import Purchases, { CustomerInfo } from 'react-native-purchases';

export const useProStatus = () => {
  const [isPro, setIsPro] = useState(false);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    checkProStatus();
    
    // Listen for updates
    Purchases.addCustomerInfoUpdateListener((customerInfo) => {
      setIsPro(customerInfo.entitlements.active['pro'] !== undefined);
    });
  }, []);
  
  const checkProStatus = async () => {
    try {
      const customerInfo = await Purchases.getCustomerInfo();
      setIsPro(customerInfo.entitlements.active['pro'] !== undefined);
    } catch (error) {
      console.error('Error checking pro status:', error);
    } finally {
      setLoading(false);
    }
  };
  
  return { isPro, loading };
};
```

---

## SECTION 7: SUCCESS METRICS & ANALYTICS

### **7.1 Key Performance Indicators (KPIs)**

| Metric | Target | Measurement |
|--------|--------|-------------|
| **Day-7 Retention** | 60% | (Active users Day 7) / (Completed onboarding) |
| **Day-30 Retention** | 40% | (Active users Day 30) / (Completed onboarding) |
| **Average Clarity Score** | 60% | Average of daily clarity scores |
| **Daily Cleanings** | 4 | Avg completed actions per active user per day |
| **Pro Conversion Rate** | 5% | (Pro subscribers) / (Free users 7+ days active) |
| **Weekly Clarity Improvement** | +15% | (Week 2 clarity) - (Week 1 clarity) |
| **NPS (Net Promoter Score)** | 50+ | Survey after 14 days |

### **7.2 Analytics Events (Firebase)**

```typescript
// Track key user actions
import analytics from '@react-native-firebase/analytics';

// Onboarding completion
await analytics().logEvent('onboarding_completed', {
  avatar_selected: 'flame',
  commitment_percentage: 10,
  time_to_complete_seconds: 120,
});

// Noise accumulation
await analytics().logEvent('noise_accumulated', {
  noise_added: 15,
  current_noise_level: 45,
  time_of_day: 14, // Hour
  app_category: 'social', // Never log specific app
});

// Cleaning action
await analytics().logEvent('cleaning_action_completed', {
  action_type: 'squats',
  action_id: 'ma_002',
  noise_cleared: 10,
  new_noise_level: 35,
  time_to_complete_seconds: 45,
  user_energy_rating: 'medium', // Optional user self-report
});

// Wiper animation viewed
await analytics().logEvent('wiper_animation_displayed', {
  noise_cleared_percent: 10,
});

// Shield triggered
await analytics().logEvent('shield_triggered', {
  noise_level_at_trigger: 85,
  time_of_day: 22,
});

// Pro conversion
await analytics().logEvent('purchase', {
  package_identifier: 'monthly',
  price_string: '‚Ç¨9,99',
  intro_offer_used: false,
});

// Clarity milestone
await analytics().logEvent('clarity_milestone', {
  milestone_type: 'crystal', // 80%+ clarity for 7 days
  streak_days: 7,
  avg_clarity_score: 85,
});

// Doom loop detected
await analytics().logEvent('doom_loop_detected', {
  app_switches_count: 5,
  time_window_seconds: 60,
});

// Mode Repas activated (France-specific)
await analytics().logEvent('meal_mode_activated', {
  time_of_day: 13, // 1 PM
  duration_minutes: 60,
});
```

### **7.3 A/B Testing Strategy**

Use Firebase Remote Config for testing variations:

```typescript
// Test: Noise accumulation rate
const noiseRateMultiplier = remoteConfig().getValue('noise_rate_multiplier').asNumber();
// Variants: 0.5 (control), 0.7, 0.3

// Test: Wiper animation duration
const wiperDuration = remoteConfig().getValue('wiper_duration_ms').asNumber();
// Variants: 800ms (control), 1000ms, 600ms

// Test: Free tier noise visualization cap
const freeNoiseVisualizationCap = remoteConfig().getValue('free_noise_cap').asNumber();
// Variants: 50% (control), 70%, 30%
```

---

## SECTION 8: FRANCE-FIRST LOCALIZATION

### **8.1 Cultural Adaptation**

**Why France First:**
1. **High iPhone penetration:** 34% market share vs. 18% Android
2. **Strong cafe culture:** "Mode Repas" resonates deeply
3. **Philosophical alignment:** French culture values intellectualism and self-discipline
4. **Less saturated market:** Digital wellbeing apps focus on US/UK

### **8.2 Localization Strategy**

```typescript
// i18n/config.ts
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import * as Localization from 'expo-localization';

import fr from './locales/fr.json';
import en from './locales/en.json';

i18n
  .use(initReactI18next)
  .init({
    resources: {
      fr: { translation: fr },
      en: { translation: en },
    },
    lng: Localization.locale.startsWith('fr') ? 'fr' : 'en',
    fallbackLng: 'en',
    interpolation: {
      escapeValue: false,
    },
  });

export default i18n;
```

### **8.3 Key Translations**

```json
// i18n/locales/fr.json
{
  "onboarding": {
    "hook_1": "Ton cerveau accumule du static.",
    "hook_2": "Il est temps de nettoyer.",
    "start": "Commencer",
    "commitment": "Je m'engage √† r√©duire mon temps d'√©cran de {{percent}}%"
  },
  "dashboard": {
    "noise_level": "Niveau de Static",
    "clarity_score": "Score de Clart√©",
    "clean_now": "Nettoyer Maintenant",
    "clarity_states": {
      "crystal": "Cristal üíé",
      "clear": "Clair ‚ú®",
      "foggy": "Brumeux üå´Ô∏è",
      "static": "Static üì∫"
    }
  },
  "shield": {
    "detected": "Static D√©tect√©: {{noiseLevel}}%",
    "clean_prompt": "Nettoie ton syst√®me nerveux",
    "start_cleaning": "Commencer le Nettoyage",
    "unlocked": "Clart√© Restaur√©e! ‚úÖ",
    "time_remaining": "Tu as {{seconds}} secondes"
  },
  "dopamine_menu": {
    "title": "Menu Dopamine",
    "subtitle": "Choisis une action pour restaurer ta clart√©",
    "spin_wheel": "Tourner la Roue",
    "or_choose": "Ou choisis directement",
    "clears_noise": "Efface {{percent}}% de static"
  },
  "meal_mode": {
    "title": "Mode Repas",
    "subtitle": "Profite de ton d√©jeuner sans √©cran",
    "duration": "1 heure",
    "activate": "Activer",
    "active": "Mode Repas Actif",
    "time_remaining": "{{minutes}} minutes restantes",
    "bon_appetit": "Bon App√©tit! üçΩÔ∏è"
  },
  "paywall": {
    "title": "D√©verrouille les Outils de Nettoyage Profond",
    "subtitle": "Les grandes actions effacent plus de static.\nRestaure ta clart√© mentale plus vite.",
    "founding_member": "Membre Fondateur",
    "benefits": [
      "Tous les outils de nettoyage (squats, marche, douche froide)",
      "Visualisation compl√®te du static (0-100%)",
      "Cercle de Clart√© (leaderboards entre amis)",
      "Mode Repas (fonctionnalit√© France)",
      "Avatar Zombie (√©tat ultime)"
    ],
    "monthly": "‚Ç¨9,99/mois",
    "annual": "‚Ç¨59,99/an",
    "save_50": "√âconomise 50%",
    "restore": "Restaurer les achats",
    "terms": "Conditions d'utilisation",
    "privacy": "Politique de confidentialit√©"
  }
}
```

---

## SECTION 9: TESTING & QUALITY ASSURANCE

### **9.1 Critical Test Scenarios**

#### **Noise Accumulation Test**
```
1. Scenario: User scrolls TikTok for 30 minutes
   Expected: Noise increases by 22.5% (30 * 0.5 * 1.5 TikTok rate)
   Verification: Check SharedStorage.get('noise_level')
   
2. Scenario: User scrolls Instagram for 60 minutes
   Expected: Noise increases by 30% (60 * 0.5 * 1.0 rate)
   Visual Check: Skia overlay opacity increases proportionally
   
3. Scenario: User switches between TikTok, Instagram, TikTok in 60s
   Expected: Doom loop detection triggers
   Expected: Push notification sent
```

#### **Cleaning Action Test**
```
1. Scenario: User completes 10 squats (2 mins)
   Expected: Noise decreases by 10%
   Expected: Wiper animation plays
   Expected: Haptic pattern "toll" fires
   Expected: Avatar state updates if crossing threshold
   
2. Scenario: User drinks water (30s)
   Expected: Noise decreases by 3%
   Expected: Wiper animation plays (smaller blade width)
   Expected: Haptic pattern "gentle" fires
```

#### **Shield Integration Test**
```
1. Scenario: Noise reaches 80%
   Expected: Emergency shield auto-triggers on next app open
   Expected: Shield displays "Static D√©tect√©: 80%"
   
2. Scenario: User taps "Commencer le Nettoyage"
   Expected: ShieldAction sets flag in App Group
   Expected: Main app detects flag within 1 second
   Expected: Challenge screen opens with sensor access
   
3. Scenario: User completes challenge
   Expected: Completion timestamp written to App Group
   Expected: Shield allows 60-second access
   Expected: After 60s, shield blocks again
```

#### **Paywall Test**
```
1. Scenario: Free user taps locked Pro action
   Expected: RevenueCat paywall presents
   Expected: Localized pricing displays (‚Ç¨9,99)
   
2. Scenario: User purchases Pro
   Expected: Purchase flows through RevenueCat
   Expected: Entitlement 'pro' activates
   Expected: All actions unlock immediately
   
3. Scenario: User restores purchase on new device
   Expected: Entitlements sync from RevenueCat
   Expected: Pro features available
```

### **9.2 Performance Benchmarks**

| Metric | Target | Measurement Tool |
|--------|--------|------------------|
| Shield Display Latency | < 200ms | Xcode Instruments |
| Skia Shader Frame Rate | 60 FPS | React Native Profiler |
| CPU Usage (with shader) | < 10% | Xcode Instruments |
| Battery Drain | < 8% per day | TestFlight Battery Logs |
| App Cold Start Time | < 3 seconds | Firebase Performance |
| Wiper Animation Smoothness | 60 FPS | Visual inspection |

### **9.3 Device Testing Matrix**

| Device | iOS Version | Priority | Notes |
|--------|-------------|----------|-------|
| iPhone 12 Mini | iOS 16.0 | High | Minimum supported version |
| iPhone 13 Pro | iOS 17.0 | Medium | Common user device |
| iPhone 14 Pro Max | iOS 17.2 | High | Dynamic Island testing |
| iPhone 15 Pro | iOS 18.0 | Critical | Latest hardware, FamilyControls updates |

---

## SECTION 10: TECHNICAL DEPENDENCIES

### **10.1 Complete Package.json**

```json
{
  "name": "exit-app",
  "version": "1.0.0",
  "dependencies": {
    "@expo/vector-icons": "^14.0.0",
    "@kingstinct/react-native-device-activity": "^1.2.0",
    "@react-native-firebase/analytics": "^18.7.0",
    "@react-native-firebase/app": "^18.7.0",
    "@react-native-firebase/auth": "^18.7.0",
    "@react-native-firebase/firestore": "^18.7.0",
    "@react-native-firebase/remote-config": "^18.7.0",
    "@shopify/react-native-skia": "^0.1.240",
    "@tamagui/config": "^1.79.0",
    "@tamagui/font-inter": "^1.79.0",
    "expo": "~50.0.0",
    "expo-av": "~13.10.0",
    "expo-blur": "~12.9.0",
    "expo-haptics": "~12.8.0",
    "expo-linear-gradient": "~12.7.0",
    "expo-localization": "~14.8.0",
    "expo-router": "~3.4.0",
    "expo-sensors": "~12.9.0",
    "i18next": "^23.7.0",
    "moti": "^0.28.0",
    "react": "18.2.0",
    "react-i18next": "^14.0.0",
    "react-native": "0.73.0",
    "react-native-purchases": "^7.0.0",
    "react-native-purchases-ui": "^7.0.0",
    "react-native-reanimated": "~3.6.0",
    "rive-react-native": "^6.0.0",
    "tamagui": "^1.79.0"
  },
  "devDependencies": {
    "@babel/core": "^7.23.0",
    "@tamagui/babel-plugin": "^1.79.0",
    "@types/react": "~18.2.0",
    "typescript": "^5.3.0"
  }
}
```

### **10.2 iOS Entitlements**

```xml
<!-- ios/exit/exit.entitlements -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <!-- Family Controls -->
    <key>com.apple.developer.family-controls</key>
    <true/>
    
    <!-- App Groups (for extension communication) -->
    <key>com.apple.security.application-groups</key>
    <array>
        <string>group.com.exit.app</string>
    </array>
</dict>
</plist>
```

### **10.3 Info.plist Requirements**

```xml
<!-- ios/exit/Info.plist -->
<key>NSFamilyControlsUsageDescription</key>
<string>Exit utilise les Contr√¥les Parentaux pour impl√©menter le Bouclier Somatique, qui t'aide √† r√©guler ton temps d'√©cran √† travers des d√©fis physiques. Cette autorisation est n√©cessaire pour afficher un √©cran personnalis√© quand tu essaies d'ouvrir des applications bloqu√©es.</string>

<key>NSMotionUsageDescription</key>
<string>Exit utilise l'acc√©l√©rom√®tre pour d√©tecter tes squats et autres mouvements physiques, te permettant de "nettoyer" ton static mental √† travers l'activit√© physique.</string>

<key>NSMicrophoneUsageDescription</key>
<string>Exit utilise le microphone uniquement pour d√©tecter ta respiration lors des exercices de respiration. Aucun audio n'est enregistr√© ou transmis.</string>
```

---

## SECTION 11: APP STORE SUBMISSION

### **11.1 Family Controls Justification Document**

**Required by Apple for FamilyControls entitlement approval.**

```markdown
# Exit - Family Controls Usage Justification

## App Purpose
Exit is a digital wellbeing application that helps users regulate their screen time through physiological interventions (breathing exercises, physical movement).

## Why We Need Family Controls

### 1. Custom Shield UI (ShieldConfiguration)
We use ShieldConfiguration to display a custom intervention screen when users attempt to open apps they've designated as "distracting." This screen:
- Shows the user's current "neural static" level (0-100%)
- Prompts them to complete a physical or breathing challenge
- Provides a button to start the challenge in the main app

The system default shield UI cannot display this information or provide our custom intervention flow.

### 2. Usage Monitoring (DeviceActivityMonitor)
We use DeviceActivityMonitor to:
- Track when usage thresholds are reached (e.g., 30 mins on TikTok)
- Calculate "noise accumulation" based on app usage
- Trigger emergency interventions when noise reaches 80%

### 3. User Empowerment
Unlike traditional parental controls, Exit is a SELF-IMPOSED system. Users voluntarily select which apps to monitor and set their own thresholds. The app functions as a "Digital Survival Kit" rather than a restrictive blocker.

## Privacy Commitment
- NO screen content is read (only metadata: bundle IDs)
- NO usage data is transmitted to our servers
- All calculations happen on-device
- Only aggregate statistics (clarity score, streak) are synced

## Video Demonstration
[Link to 30-second screen recording showing:]
1. User opens Instagram
2. Custom shield appears with noise level
3. User taps "Start Challenge"
4. Challenge screen opens with squat counter
5. Upon completion, shield shows "Clarity Restored"
6. User accesses Instagram for 60 seconds

## Contact
Developer: [Name]
Email: [Email]
Company: [Company Name]
```

### **11.2 App Store Metadata**

**App Name:**
```
Exit: Neural Clarity
```

**Subtitle:**
```
Clear the static. Restore your clarity.
```

**Keywords (France):**
```
temps d'√©cran, bien-√™tre num√©rique, addiction smartphone, clart√© mentale, r√©gulation dopamine, sant√© mentale, productivit√©, m√©ditation, respiration, mouvement physique
```

**Description (French):**
```
Exit n'est pas un bloqueur d'applications. C'est un outil de r√©gulation du syst√®me nerveux.

Le Probl√®me
Chaque minute de scrolling ajoute du "static neural" ‚Äî du bruit cognitif qui rend difficile la pens√©e claire, la prise de d√©cision, ou simplement le fait d'√™tre pr√©sent.

La Solution
Exit visualise ce static en temps r√©el et te fournit des outils de nettoyage (actions physiques) pour restaurer ta clart√©.

Comment √áa Marche
1. Le scrolling ajoute du static (bruit visuel sur ton √©cran)
2. Ton interface devient floue et difficile √† lire
3. Tu choisis une action du Menu Dopamine (respiration, squats, marche)
4. Une animation de nettoyage efface le static
5. Ton √©cran redevient clair

C'est comme nettoyer tes lunettes ‚Äî tu ne les essuies pas parce que tu es "en dette" envers la salet√©. Tu les essuies pour maintenir ta visibilit√©.

Fonctionnalit√©s
‚Ä¢ Bouclier Somatique: Interventions physiques avant d'ouvrir les apps
‚Ä¢ Visualisation du Static: Vois l'impact du scrolling en temps r√©el
‚Ä¢ Menu Dopamine: 8+ actions pour nettoyer ton esprit
‚Ä¢ Avatar Vivant: Il refl√®te ton √©tat physique r√©el
‚Ä¢ Mode Repas: Bloque ton t√©l√©phone pendant le d√©jeuner (France)
‚Ä¢ Cercle de Clart√©: Soutenez-vous mutuellement (Pro)

Gratuit vs Pro
Gratuit: Respiration + Eau (nettoie 5-8% de static)
Pro: Tous les outils (nettoie jusqu'√† 30% de static)

Abonnement: ‚Ç¨9,99/mois ou ‚Ç¨59,99/an

Maintenance, pas dette. Clart√©, pas culpabilit√©.
```

### **11.3 App Preview Video Script**

```
[0-3s] Opening shot: Phone screen filled with grainy static
       Text overlay: "Ton cerveau accumule du static."

[3-6s] User scrolling TikTok rapidly
       Static overlay intensifies, numbers blur

[6-9s] User tries to read stats but can't
       Text overlay: "Il est temps de nettoyer."

[9-12s] Shield appears: "Static D√©tect√©: 75%"
        Button: "Commencer le Nettoyage"

[12-15s] Challenge screen: Squat counter animating
         User completes squats (motion graphics)

[15-18s] Wiper animation sweeps across screen
         Static clears, revealing crisp interface

[18-21s] Dashboard shows Clarity Score: 82%
         Avatar glows orange (vitality state)

[21-24s] Text overlay: "Maintenance, pas dette."
         App icon + "Exit: Neural Clarity"

[24-27s] "T√©l√©charge maintenant"
         App Store logo
```

---

## SECTION 12: RISK MITIGATION & FAILURE MODES

### **12.1 Risk Matrix**

| Risk | Likelihood | Impact | Mitigation |
|------|-----------|---------|-----------|
| **App Store Rejection (Family Controls)** | Medium | Critical | Early entitlement request (3-5 business days), comprehensive video documentation, explicit privacy policy |
| **User Circumvention (Jailbreak)** | High | Medium | Graceful degradation with warning message, focus on 95% of non-technical users |
| **Battery Drain Complaints** | Medium | High | Aggressive optimization: shader at 60 FPS, reduce polling to 2s intervals, stop animations on screen lock |
| **Sensor Spoofing (Fake Squats)** | High | Low | Anti-cheat patterns detect irregular movement, but accept some gaming (better than scrolling) |
| **Deep Link Loop Failure** | Low | Critical | Fallback to 5-minute cooldown if deep link doesn't open within 10 seconds, manual "Unlock App" button in Settings |
| **Privacy Breach (Crash Logs)** | Low | Critical | Sanitize all logs before sending to Firebase Crashlytics, never log package names, third-party security audit |
| **Firebase Quota Overwhelm** | Low | High | Enable auto-scaling, implement rate limiting on Cloud Functions, monitor quota dashboard |
| **Skia Shader Performance** | Medium | High | Use built-in FractalNoise (optimized), limit shader complexity, provide "Low Performance Mode" setting |

### **12.2 Contingency Plans**

#### **If App Store Rejects Family Controls:**
1. Pivot to "Honor System" mode where user self-reports challenges
2. Implement iOS Screen Time widget instead of native shield
3. Reduce scope to breathing-only MVP (no squats/accelerometer)

#### **If Battery Drain Exceeds 10%:**
1. Move accelerometer monitoring to on-demand (only during active challenges)
2. Replace continuous polling with iOS Background Tasks API (triggers on schedule)
3. Add battery optimization tips in Settings
4. Provide "Eco Mode" that reduces shader complexity

#### **If Conversion Rate < 3%:**
1. A/B test paywall timing (after 3 cleanings vs. after 7 days)
2. Offer 7-day free trial for Pro
3. Add "pay what you want" tier (‚Ç¨4.99-‚Ç¨19.99)
4. Increase free tier noise visualization cap to 70%

---

## CONCLUSION

Exit v16.0 represents the culmination of research, iteration, and strategic positioning. By reframing digital wellbeing from **punishment to maintenance**, we create a product that:

1. **Respects User Agency:** No shame, only tools
2. **Delivers Instant Feedback:** Skia shader creates functional friction
3. **Feels Premium:** Quiet Luxury aesthetic signals sophistication
4. **Monetizes Effectively:** Clear value prop (deep cleaning tools unlock faster restoration)
5. **Scales Globally:** France-first, but architecture supports worldwide expansion

**The Path Forward:**

| Timeline | Milestone |
|----------|-----------|
| **Week 1-2** | Implement Skia noise overlay + basic noise formula |
| **Week 3-4** | Build iOS extensions + deep link loop |
| **Week 5-6** | Create Dopamine Menu + Wiper animation |
| **Week 7-8** | Integrate RevenueCat + paywall |
| **Week 9-10** | Alpha testing (internal team, 20 users) |
| **Week 11-12** | Beta launch (TestFlight, 1,000 French users) |
| **Week 13-14** | Iterate based on feedback + polish |
| **Week 15-16** | App Store submission + PR launch |

**Success = 10,000 downloads + 5% conversion in Month 1.**

---

**Document Version:** 16.0 (The Final Master Blueprint)  
**Last Updated:** December 27, 2025  
**Authors:** Head of Product + Lead Architect (AI-Assisted)  
**Status:** **Production Ready** üöÄ  
**Next Action:** Begin Week 1 development sprint

---

## APPENDIX A: HAPTIC PATTERNS REFERENCE

```typescript
// utils/HapticMap.ts
import * as Haptics from 'expo-haptics';

export class HapticMap {
  // Heartbeat: Shield is active, steady pulse
  static heartbeat() {
    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
  }
  
  // Toll Paid: Physical action completed (squats)
  static tollPaid() {
    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Heavy);
  }
  
  // Unlock: Successfully restored clarity
  static unlock() {
    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
  }
  
  // Warning: Doom loop detected
  static warning() {
    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Warning);
  }
  
  // Selection: UI element tapped (wheel tick)
  static selection() {
    Haptics.selectionAsync();
  }
  
  // Achievement: Milestone reached (triple-tap pattern)
  static achievement() {
    setTimeout(() => Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium), 0);
    setTimeout(() => Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium), 100);
    setTimeout(() => Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Heavy), 200);
  }
  
  // Static Buildup: Random irregular ticks (cognitive noise)
  static staticBuildup() {
    const count = Math.floor(Math.random() * 3) + 1;
    for (let i = 0; i < count; i++) {
      setTimeout(() => {
        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
      }, i * 100 + Math.random() * 50);
    }
  }
  
  // Clarity Restored: Sharp snap followed by gentle fade
  static clarityRestored() {
    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Heavy);
    setTimeout(() => {
      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
    }, 150);
  }
  
  // Gentle: Low-energy actions (drinking water)
  static gentle() {
    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
  }
  
  // Shock: High-intensity actions (cold shower)
  static shock() {
    // Rapid sequence simulating cold shock
    for (let i = 0; i < 5; i++) {
      setTimeout(() => {
        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Heavy);
      }, i * 50);
    }
  }
}
```

---

## APPENDIX B: FIREBASE SECURITY RULES

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // User profile - user can only read/write their own
    match /users/{uid} {
      allow read, write: if request.auth != null && request.auth.uid == uid;
    }
    
    // User stats - read-only for authenticated users (written by Cloud Functions)
    match /users/{uid}/stats/{date} {
      allow read: if request.auth != null && request.auth.uid == uid;
      allow write: if false; // Only Cloud Functions can write
    }
    
    // Clarity Circle - members can read, only owner can write
    match /circles/{circleId} {
      allow read: if request.auth != null && 
                     request.auth.uid in resource.data.memberIds;
      allow write: if request.auth != null && 
                      request.auth.uid == resource.data.ownerId;
    }
  }
}
```

---

**END OF DOCUMENT**
